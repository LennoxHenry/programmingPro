<!doctype html>
<html>

<head>
    <title>The Game</title>
</head>

<body>
    <canvas id="gameCanvas" width="400" height="700"></canvas>
    <script>
        var canvas, canvasContext;

        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');

            document.addEventListener('keydown', keyPressed);
            document.addEventListener('keyup', keyReleased);

            setInterval(mainLoop, 1000 / 50);
        }

        var playerXpos = 0;
        var playerYpos = 0;
        const PLAYER_HEIGHT = 20;
        const PLAYER_WIDTH = 20;
        var playerSpeed = 7;

        var bXpos = 150;
        var bYpos = 0;
        const B_HEIGHT = 30;
        const B_WIDTH = 30;
        var bXspeed = 7;
        var bYspeed = 7;
        
        var balls = [];
        var ballTotal = 7;

        const LEFT_ARROW_KEY = 37;
        const RIGHT_ARROW_KEY = 39;
        var leftArrowKeyPressed = false;
        var rightArrowKeyPressed = false;

        var startingPos = true;



        function mainLoop() {
            colorRect(0, 0, canvas.width, canvas.height, 'black');
            colorRect(playerXpos, playerYpos, PLAYER_WIDTH, PLAYER_HEIGHT, 'lightGreen');

            colorRect()

            if (startingPos) {
                startPos();
                startingPos = false;
            }


            playerMove();
            ballsRender();
            ballMove();
            collision();
        }

        function createBalls(){
            const BALL_SIZE = 20;
            var ballXpos = Math.floor(Math.random()*(canvas.width - BALL_SIZE));
            var ballYpos = 0 - BALL_SIZE;
            var ballXspeed = 5;
            var ballYspeed = 5;
            
            var randBalls = {
                BALL_SIZE: 20,
                ballXpos: ballXpos,
                ballYpos: ballYpos,
                ballXspeed: ballXspeed,
                ballYspeed: ballYspeed
            }
            return randBalls;
        }


        function ballMove() {
            balls.forEach(function(ball,index){
                ball.ballYpos += ball.ballYspeed;
                ball.ballXpos += ball.ballXspeed;
                if (ball.ballXpos > canvas.width - B_WIDTH) {
                    ball.ballXspeed *= -1;
                }
                if (ball.ballXpos < 0) {
                    ball.ballXspeed *= -1;
                }
                if(ball.ballYpos > canvas.height){
                   ball.ballYpos = 0;
                }
                
            });
      


        }

        function keyPressed(evt) {
            if (evt.keyCode == LEFT_ARROW_KEY) {
                leftArrowKeyPressed = true;
            }
            if (evt.keyCode == RIGHT_ARROW_KEY) {
                rightArrowKeyPressed = true;
            }

        }

        function keyReleased(evt) {
            if (evt.keyCode == LEFT_ARROW_KEY) {
                leftArrowKeyPressed = false;
            }
             if (evt.keyCode == RIGHT_ARROW_KEY) {
                rightArrowKeyPressed = false;
            }

        }




        function playerMove() {
            if (leftArrowKeyPressed)
                playerXpos -= playerSpeed;
            if (playerXpos < 0) {
                playerXpos = canvas.width - PLAYER_WIDTH;

            }


            if (rightArrowKeyPressed) {
                playerXpos += playerSpeed;
                if (playerXpos > canvas.width - PLAYER_WIDTH) {
                    playerXpos = 0;
                }
            }
        }


        function colorRect(x, y, w, h, color) {
            canvasContext.fillStyle = color;
            canvasContext.fillRect(x, y, w, h);
        }
        
        function ballsRender(){
            balls.forEach(function(ball,index){
                colorRect(ball.ballXpos, ball.ballYpos, ball.BALL_SIZE,ball.BALL_SIZE, 'red');
            });
        }

        function startPos() {
            playerXpos = canvas.width / 2 - PLAYER_WIDTH / 2;
            playerYpos = canvas.height - PLAYER_HEIGHT;
            
            for(i=0;i<ballTotal; i++){
                balls.push(createBalls());
            }
        }
        
        function collision(){
            if (playerYpos + PLAYER_HEIGHT, PLAYER_WIDTH > bYpos && playerYpos < bYpos + B_HEIGHT, B_WIDTH
               && playerXpos + PLAYER_HEIGHT, PLAYER_WIDTH > bXpos && playerYpos < bXpos + B_HEIGHT, B_WIDTH){
                starting = true;
            }
        }

    </script>
</body>

</html>
